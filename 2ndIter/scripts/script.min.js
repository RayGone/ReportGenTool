var active_machines=[];function getHeaders(e){switch(e){case"PM03":return"Date,Time,A400 Circuit Status,A270 Circuit Status,PM-03 Device Status,BC-82 Device Status,PM-03 Sound Control FB,PM-03 Sound Control SP,PM-03 Sound Control CV,BC-82 Speed SP,PM-03 Sound Control Enable,BE-15 Amps\n";case"PM06":return"Date,Time,AS-06 Flow %,FA-54 Amps %,FA-54 Flow %,FI-04 DP,FA-54 Drive Bearing Temp,FA-54 Non-Drive Bearing Temp,PM-06 Feed Side Bearing Temp,PM-06 Outlet Side Bearing Temp,CW-13 %,CW-14 %,CW-15 %,CW-16 %,CW-17 %,CW-18 %,,,PM-06 Amps %,FA-54 Speed %,FA-54 Drive Bearing Vibration,FA-54 Non-Drive Bearing Vibration,FA-54 Primary Flow SP,FA-54 Primary Flow FB,PM-06 U Winding Temp,PM-06 V Winding Temp,PM-06 W Winding Temp,PM-06 Drive Side Bearing Temp,PM-06 Non-Drive Side Bearing Temp,FA-54 U Winding Temp,FA-54 V Winding Temp,FA-54 W Winding Temp,FA-54 Drive Side Bearing Temp,FA-54 Non-Drive Side Bearing Temp,LU-06 Grease Pump Enabled,LU-06 Grease Pump Run Status,LU-06 Grease Pump System Fault Status,LU-06 Grease Pump Min Since Last Cycle,LU-06 Grease Pump Run Time (Min),BC-88 TPH FB,BC-88 TPH SP,BC-88 Speed %,PM-06 Amps,FA-54 Amps,SI-23 Tons,PM-06 Tons SP,CW-13 RPM,CW-14 RPM,CW-15 RPM,CW-16 RPM,CW-17 RPM,CW-18 RPM,CW-13 Power FB,CW-14 Power FB,CW-15 Power FB,CW-16 Power FB,CW-17 Power FB,CW-18 Power FB,BC-88 Feed Rate,BC-88 Feed Rate By SI-23 Weight\n";default:return""}}function fileSelectionObserver(e){if(!(e.files.length>0))return document.querySelector(".machine").classList.add("d-none"),void(active_machines=[]);document.querySelector(".machine").classList.remove("d-none");let t=[];for(let n of e.files){let e=n.name.split("_")[0];t.push(e)}t=[...new Set(t)],active_machines=t;let n=document.getElementById("sel-mac");n.innerHTML="";for(let e of t)n.innerHTML+=`<span class='badge badge-pill badge-primary display-4 m-3'>${e}</span>`}function parseCSVToJSON(e,t=!1){return e.slice(t?csv.indexOf("\n")+1:0).split("\n").map(e=>e.split(","))}function createTimeStampedDict(e){let t={},n=[];for(let i of e){if(time=new Date(i[0]+" "+i[1]),!time||isNaN(time))break;time=parseInt(time.getTime()/1e3),n.push(time),t[time]=i}return n.sort(),[t,n]}function arrayToCSV(e,t=","){return e.map(e=>e.map(e=>`"${e}"`).join(t)).join("\n")}function processUpdate(e){}function process(e,t,n){let i,r=document.getElementById(n);document.querySelector(".modal").classList.toggle("d-none");let o=new FileReader;o.addEventListener("load",e=>{let n=60*document.querySelector("[name=filter]").value;var o=e.target.result;let a;[o,a]=createTimeStampedDict(parseCSVToJSON(o));let l=i.split("_")[0]+"_"+o[a[0]][0]+`_outputfile_${n/60}min-average_${(new Date).getTime()}.csv`;r.children[2].innerHTML=l;let d=[],s=a[0],m=o[s],c=m[1],u=0;for(let e=1;e<a.length;e++){if(u++,r.children[3].innerHTML=(e/a.length*100).toFixed(2)+"%",a[e]-s<=n){for(let t=2;t<m.length;t++)m[t]=parseFloat(m[t])+parseFloat(o[a[e]][t]);c=o[a[e]][1]}else{m[1]+=" - "+c;for(let e=2;e<m.length;e++)m[e]/=u,m[e]=m[e].toFixed(4);u=0,d.push(m),c=(m=o[s=a[e]])[1]}}m[1]+=" - "+c;for(let e=2;e<m.length;e++)m[e]/=u,m[e]=m[e].toFixed(4);r.children[3].innerHTML="Preparing for download....",d.push(m);let p=getHeaders(t)+arrayToCSV(d);document.querySelector(".modal").classList.remove("d-none"),r.children[3].innerHTML="Complete",r.scrollIntoView(),downloadCSV(p,l)}),i=e.name.split(".")[0],o.readAsText(e)}function downloadCSV(e,t){var n,i;n=new Blob([e],{type:"text/csv"}),(i=document.createElement("a")).download=t,i.href=window.URL.createObjectURL(n),i.style.display="none",document.querySelector(".download-list").appendChild(i),setTimeout(i.click()),setTimeout(function(e){e.parentNode.removeChild(e)},3e3,i)}function run(){document.querySelector(".modal").classList.remove("d-none"),document.querySelector(".starter").setAttribute("disabled",!0);let e=document.querySelector("tbody");e.innerHTML="";let t=document.getElementById("files"),n=0,i=!1;for(let r of active_machines)if("PM03"==r)for(let o of t.files)o.name.includes(r)&&(n++,i=!0,e.innerHTML+=`<tr id="${r}_${n}">\n                    <th scope='row'>${n}</th>\n                    <td>${o.name}</td>\n                    <td></td>\n                    <td>0%</td>\n                </tr>`),i&&(i=!1,setTimeout(process,1e3,o,r,r+"_"+n))}function closeModal(){document.querySelector(".starter").removeAttribute("disabled"),document.querySelector(".machine").classList.add("d-none"),document.querySelector(".modal").classList.add("d-none");let e=document.getElementById("files");e.type="",e.type="file"}